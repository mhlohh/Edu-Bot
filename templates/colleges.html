{% extends "base.html" %}
{% block content %}

<section class="page-section fade-in" style="margin-top: 120px;">

  <h2 style="text-align:center;">🏫 Top Colleges (Filtered Results)</h2>

  {% if colleges %}
  <div class="college-list">
    {% for c in colleges %}
      <div class="college-item">
        <div class="rank-badge">{{ c.rank or 'N/A' }}</div>
        <div class="college-info">
          <h2><a href="{{ c.website }}" class="college-link" target="_blank">{{ c.name }}</a></h2>
          <p>📍 {{ c.city }}, {{ c.state }}</p>

          {% if c.courses %}
            <p><strong>🎓 Courses:</strong> {{ c.courses | join(', ') }}</p>
          {% endif %}

          {% set min_fee = None %}
          {% if c.fees_structure %}
            {% for course, fee_data in c.fees_structure.items() %}
              {% set v = fee_data.get('fee_per_year_in_inr') or fee_data.get('total_estimated_fee_in_inr') or fee_data.get('fee') %}
              {% if v is defined and v %}
                {% if min_fee is none or v < min_fee %}
                  {% set min_fee = v %}
                {% endif %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if min_fee %}
            <p><strong>💸 Min Fee:</strong> ₹{{ min_fee }}</p>
          {% endif %}

          <a href="{{ c.website }}" target="_blank" class="details-btn">Visit Website</a>
        </div>
      </div>
    {% endfor %}
  </div>
  {% else %}
    <div style="text-align:center; margin-top: 50px;">
      <h3>❌ No matching colleges found.</h3>
      {% if gemini_text %}
        <p style="margin-top: 20px; white-space: pre-line;">🤖 Suggestions from AI:<br>{{ gemini_text }}</p>
      {% endif %}
      <a href="/" class="details-btn" style="margin-top: 20px; display:inline-block;">🔍 Try Again</a>
    </div>
  {% endif %}

</section>

{% endblock %}
